{{ define "main" }}
  <article class="single-article">
    <h2>{{ .Title }}</h2>
    {{ if .Params.subtitle }}
      <h4>{{ .Params.subtitle }}</h4>
      <hr class="bar">
    {{ end }}
    
    {{ $paragraphs := split .RawContent "\n\n" }}
    {{ $imageIndex := 0 }}
    
    {{ range $paragraph := $paragraphs }}
      {{ $trimmed := trim $paragraph " \n" }}
      {{ if ne $trimmed "" }}
        <div class="single-paragraph-block">
          <div class="single-text-content">
            {{ $trimmed | markdownify }}
          </div>
          {{ if $.Params.images }}
            <div class="single-image-content">
              <img 
                src="{{ index $.Params.images $imageIndex | relURL }}" 
                alt="Content image {{ add $imageIndex 1 }}" 
                class="single-paragraph-image"
              >
            </div>
            {{ $imageIndex = add $imageIndex 1 }}
            {{ if ge $imageIndex (len $.Params.images) }}
              {{ $imageIndex = 0 }}
            {{ end }}
          {{ end }}
        </div>
      {{ end }}
    {{ end }}
  </article>
{{ end }}